"use strict";var U=Object.defineProperty;var _=(a,t,e)=>t in a?U(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var l=(a,t,e)=>(_(a,typeof t!="symbol"?t+"":t,e),e),F=(a,t,e)=>{if(!t.has(a))throw TypeError("Cannot "+e)};var b=(a,t,e)=>(F(a,t,"read from private field"),e?e.call(a):t.get(a)),x=(a,t,e)=>{if(t.has(a))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(a):t.set(a,e)},S=(a,t,e,s)=>(F(a,t,"write to private field"),s?s.call(a,e):t.set(a,e),e);Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const f=require("vue");function z(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var L=function a(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){if(t.constructor!==e.constructor)return!1;var s,n,o;if(Array.isArray(t)){if(s=t.length,s!=e.length)return!1;for(n=s;n--!==0;)if(!a(t[n],e[n]))return!1;return!0}if(t.constructor===RegExp)return t.source===e.source&&t.flags===e.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===e.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===e.toString();if(o=Object.keys(t),s=o.length,s!==Object.keys(e).length)return!1;for(n=s;n--!==0;)if(!Object.prototype.hasOwnProperty.call(e,o[n]))return!1;for(n=s;n--!==0;){var c=o[n];if(!a(t[c],e[c]))return!1}return!0}return t!==t&&e!==e};const R=z(L);function r(a,t){return!Number.isInteger(a)||!Number.isInteger(t)?Math.random()*(t-a)+a:Math.floor(Math.random()*(t-a+1)+a)}function v(a,t,e){return(1-e)*a+e*t}function N(a){const t=Math.floor(Math.random()*a.length);return a[t]}function I(a){return a?{height:a.offsetHeight,width:a.offsetWidth}:{height:0,width:0}}const q=Math.PI*2,d={color:"#dee4fd",radius:[.5,3],speed:[1,3],wind:[-.5,2],changeFrequency:200,rotationSpeed:[-1,1],opacity:[1,1],enable3DRotation:!1},m=class m{constructor(t,e={}){l(this,"config");l(this,"params");l(this,"framesSinceLastUpdate");l(this,"image");this.updateConfig(e);const{radius:s,wind:n,speed:o,rotationSpeed:c,opacity:i,enable3DRotation:h}=this.config;this.params={x:r(0,t.offsetWidth),y:r(-t.offsetHeight,0),rotation:r(0,360),radius:r(...s),speed:r(...o),wind:r(...n),rotationSpeed:r(...c),nextSpeed:r(...o),nextWind:r(...n),nextRotationSpeed:r(...c),opacity:r(...i),hasNextOpacity:!1,rotationX:h?r(0,360):0,rotationY:h?r(0,360):0,rotationSpeedX:h?r(-2,2):0,rotationSpeedY:h?r(-2,2):0,nextRotationSpeedX:h?r(-2,2):0,nextRotationSpeedY:h?r(-2,2):0},this.framesSinceLastUpdate=0}static createSnowflakes(t,e,s){if(!t)return[];const n=[];for(let o=0;o<e;o++)n.push(new m(t,s));return n}selectImage(){this.config.images&&this.config.images.length>0?this.image=N(this.config.images):this.image=void 0}updateConfig(t){const e=this.config;this.config={...d,...t},this.config.changeFrequency=r(this.config.changeFrequency,this.config.changeFrequency*1.5),this.params&&!R(this.config.radius,e==null?void 0:e.radius)&&(this.params.radius=r(...this.config.radius)),R(this.config.images,e==null?void 0:e.images)||this.selectImage(),e!=null&&e.opacity&&!R(this.config.opacity,e==null?void 0:e.opacity)&&(this.params.hasNextOpacity=!0)}updateTargetParams(){this.params.nextSpeed=r(...this.config.speed),this.params.nextWind=r(...this.config.wind),this.image&&(this.params.nextRotationSpeed=r(...this.config.rotationSpeed)),this.config.enable3DRotation&&(this.params.nextRotationSpeedX=r(-2,2),this.params.nextRotationSpeedY=r(-2,2))}update(t,e,s=1){const{x:n,y:o,rotation:c,rotationSpeed:i,nextRotationSpeed:h,wind:u,speed:y,nextWind:k,nextSpeed:M,radius:p}=this.params;this.params.x=(n+u*s)%(t+p*2),this.params.x>t+p&&(this.params.x=-p),this.params.y=(o+y*s)%(e+p*2),this.params.y>e+p&&(this.params.hasNextOpacity&&(this.params.opacity=r(...this.config.opacity),this.params.hasNextOpacity=!1),this.params.y=-p),(this.image||this.config.enable3DRotation)&&(this.params.rotation=(c+i)%360),this.config.enable3DRotation&&(this.params.rotationX=(this.params.rotationX+this.params.rotationSpeedX*s)%360,this.params.rotationY=(this.params.rotationY+this.params.rotationSpeedY*s)%360),this.params.speed=v(y,M,.01),this.params.wind=v(u,k,.01),this.params.rotationSpeed=v(i,h,.01),this.config.enable3DRotation&&(this.params.rotationSpeedX=v(this.params.rotationSpeedX,this.params.nextRotationSpeedX,.01),this.params.rotationSpeedY=v(this.params.rotationSpeedY,this.params.nextRotationSpeedY,.01)),this.framesSinceLastUpdate++>this.config.changeFrequency&&(this.updateTargetParams(),this.framesSinceLastUpdate=0)}getImageOffscreenCanvas(t,e){var n;if(t instanceof HTMLImageElement&&t.loading)return t;let s=m.offscreenCanvases.get(t);if(s||(s={},m.offscreenCanvases.set(t,s)),!(e in s)){const o=document.createElement("canvas");o.width=e,o.height=e,(n=o.getContext("2d"))==null||n.drawImage(t,0,0,e,e),s[e]=o}return s[e]??t}apply3DTransform(t,e,s){if(this.config.enable3DRotation){const{rotationX:n,rotationY:o}=this.params,c=this.params.rotation||0,i=n*Math.PI/180,h=o*Math.PI/180,u=c*Math.PI/180,y=Math.cos(i),k=Math.sin(i),M=Math.cos(h),p=Math.sin(h),D=Math.cos(u),O=Math.sin(u),P=D*M,T=D*p*k-O*y,E=D*p*y+O*k,j=O*M;t.setTransform(P,T,E,j,e,s)}else{const o=(this.params.rotation||0)*Math.PI/180,c=Math.cos(o),i=Math.sin(o);t.setTransform(c,i,-i,c,e,s)}}drawCircle(t){t.moveTo(this.params.x,this.params.y),t.arc(this.params.x,this.params.y,this.params.radius,0,q)}drawCircle3D(t,e){const{x:s,y:n,radius:o}=this.params;t.save(),this.config.enable3DRotation?this.apply3DTransform(t,s,n):t.translate(s,n),t.beginPath(),t.arc(0,0,o,0,q),t.fillStyle=e,t.fill(),t.restore()}drawImage(t){const{x:e,y:s,radius:n}=this.params;t.save(),this.params.opacity!==1&&(t.globalAlpha=this.params.opacity),this.apply3DTransform(t,e,s);const o=this.getImageOffscreenCanvas(this.image,n);t.drawImage(o,-(n/2),-(n/2),n,n),t.restore()}};l(m,"offscreenCanvases",new WeakMap);let C=m;const W={pointerEvents:"none",backgroundColor:"transparent",position:"absolute",top:0,left:0,width:"100%",height:"100%"},A=1e3/60;var g,w;class X{constructor(t,e){l(this,"lastUpdate",Date.now());l(this,"snowflakes",[]);l(this,"config");x(this,g,void 0);x(this,w,void 0);l(this,"animationFrame");S(this,w,t),S(this,g,t.getContext("2d")),this.config={snowflakeCount:150,...d,...e},this.snowflakes=[],this.snowflakes=C.createSnowflakes(t,e.snowflakeCount||150,e),this.play()}get ctx(){return b(this,g)}get canvas(){return b(this,w)}set canvas(t){S(this,w,t),S(this,g,t.getContext("2d"))}updateConfig(t){this.config={...this.config,...t};const e=this.config.snowflakeCount-this.snowflakes.length;e>0&&(this.snowflakes=[...this.snowflakes,...C.createSnowflakes(this.canvas,e,t)]),e<0&&(this.snowflakes=this.snowflakes.slice(0,this.config.snowflakeCount));for(const s of this.snowflakes)s.updateConfig(this.config)}render(t=1){const{ctx:e,canvas:s,snowflakes:n}=this;if(!e||!s)return;const{offsetWidth:o,offsetHeight:c}=s;for(const i of n)i.update(o,c,t);if(e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,o,c),this.config.images&&this.config.images.length>0){for(const i of n)i.drawImage(e);return}if(this.config.enable3DRotation)for(const i of n)i.drawCircle3D(e,this.config.color);else{e.beginPath();for(const i of n)i.drawCircle(e);e.fillStyle=this.config.color,e.fill()}}loop(){const t=Date.now(),e=Date.now()-this.lastUpdate;this.lastUpdate=t;const s=e/A;this.render(s),this.animationFrame=requestAnimationFrame(()=>this.loop())}play(){this.loop()}pause(){this.animationFrame&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=void 0)}}g=new WeakMap,w=new WeakMap;function B(a){const t=f.ref(I(a.value)),e=()=>{a.value&&(t.value=I(a.value))};let s=null;return f.onMounted(()=>{a.value&&(e(),typeof ResizeObserver=="function"?(s=new ResizeObserver(e),s.observe(a.value)):window.addEventListener("resize",e))}),f.onUnmounted(()=>{s?s.disconnect():window.removeEventListener("resize",e)}),t}function H(a){return f.computed(()=>({...W,...a.value||{}}))}function Z(a){const t=f.ref(a());return f.watch(a,e=>{R(e,t.value)||(t.value=e)},{deep:!0}),t}const G=["height","width"],Y=f.defineComponent({__name:"Snowfall",props:{color:{default:()=>d.color},radius:{default:()=>d.radius},speed:{default:()=>d.speed},wind:{default:()=>d.wind},changeFrequency:{default:()=>d.changeFrequency},snowflakeCount:{default:150},images:{default:void 0},rotationSpeed:{default:()=>d.rotationSpeed},opacity:{default:()=>d.opacity},enable3DRotation:{type:Boolean,default:!1},style:{default:void 0}},setup(a){const t=a,e=f.toRef(t,"style"),s=H(e),n=f.ref(null),o=B(n),c=Z(()=>({color:t.color,changeFrequency:t.changeFrequency,radius:t.radius,speed:t.speed,wind:t.wind,rotationSpeed:t.rotationSpeed,images:t.images,snowflakeCount:t.snowflakeCount,opacity:t.opacity,enable3DRotation:t.enable3DRotation}));let i;return f.onMounted(()=>{n.value&&(i=new X(n.value,c.value))}),f.onUnmounted(()=>{i==null||i.pause(),i=void 0}),f.watch(c,h=>{i&&i.updateConfig(h)},{deep:!0}),(h,u)=>(f.openBlock(),f.createElementBlock("canvas",{ref_key:"canvasRef",ref:n,height:f.unref(o).height,width:f.unref(o).width,style:f.normalizeStyle(f.unref(s)),"data-testid":"SnowfallCanvas"},null,12,G))}});exports.Snowfall=Y;exports.SnowfallCanvas=X;exports.default=Y;
